<!-- ===================== NAVIGATION BAR ===================== -->

<style>
  /* NAV BAR WRAPPER */
  .navbar {
    background: white;
    display: flex;
    justify-content: center;
    gap: 20px;
    padding: 12px;
    box-shadow: 0 3px 8px rgba(0,0,0,0.15);
    position: sticky;
    top: 0;
    z-index: 10;
    flex-wrap: wrap;
  }

  /* MENU BUTTONS */
  .navbar a, .dropdown-btn {
    text-decoration: none;
    color: #023e8a;
    font-weight: 700;
    padding: 10px 16px;
    background: linear-gradient(145deg, #ffffff, #d4e9ff);
    border-radius: 10px;
    box-shadow: 4px 4px 10px #c4d8ff, -4px -4px 10px #ffffff;
    cursor: pointer;
    transition: 0.3s;
  }

  .navbar a:hover, .dropdown-btn:hover {
    transform: translateY(-3px);
    box-shadow: 4px 4px 14px #a4c8ff, -4px -4px 14px #ffffff;
  }

  /* DROPDOWN CONTAINER */
  .dropdown {
    position: relative;
    display: inline-block;
  }

  /* DROPDOWN MENU */
  .dropdown-content {
    display: none;
    position: absolute;
    background: white;
    min-width: 180px;
    border-radius: 10px;
    box-shadow: 0 6px 18px rgba(0,0,0,0.20);
    padding: 8px 0;
    z-index: 20;
  }

  .dropdown-content a {
    display: block;
    padding: 10px 16px;
    font-weight: 600;
    color: #023e8a;
    text-decoration: none;
    border-radius: 8px;
  }

  .dropdown-content a:hover {
    background: #e6f1ff;
  }

  /* SHOW DROPDOWN ON HOVER */
  .dropdown:hover .dropdown-content {
    display: block;
  }

  /* MOBILE SUPPORT */
  @media (max-width: 700px) {
    .dropdown-content {
      position: static;
      box-shadow: none;
      background: #f7fbff;
    }
  }
</style>

<nav class="navbar">
  <a href="index.html">Home</a>

  <!-- ABOUT DROPDOWN -->
  <div class="dropdown">
    <div class="dropdown-btn">About ▾</div>
    <div class="dropdown-content">
      <a href="about.html">School Profile</a>
      <a href="principal.html">Principal Message</a>
      <a href="staff.html">Staff</a>
    </div>
  </div>

  <!-- ACADEMICS DROPDOWN -->
  <div class="dropdown">
    <div class="dropdown-btn">Academics ▾</div>
    <div class="dropdown-content">
      <a href="admission.html">Admission</a>
      <a href="results.html">Results</a>
      <a href="mdm.html">Mid-Day Meal</a>
    </div>
  </div>

  <!-- STUDENTS DROPDOWN -->
  <div class="dropdown">
    <div class="dropdown-btn">Students ▾</div>
    <div class="dropdown-content">
      <a href="gallery.html">Gallery</a>
      <a href="activities.html">Activities</a>
      <a href="achievements.html">Achievements</a>
    </div>
  </div>

  <a href="contact.html">Contact</a>
  <a href="admin.html">Admin Panel</a>
</nav>
      const box = document.createElement('div'); box.className='student-card';
      box.innerHTML = `<div class="photo">${s.photo?'<img src="'+s.photo+'" style="width:100%;height:100%;object-fit:cover">':(s.name? s.name.charAt(0):'S')}</div>
        <div style="font-weight:800">${s.name}</div>
        <div class="small">${s.class||''} • Roll: ${s.roll||s.id}</div>
        <div style="display:flex;gap:6px;justify-content:center;margin-top:8px">
          <button onclick="editStudent('${s.id}')" class="btn">Edit</button>
          <button onclick="deleteStudent('${s.id}')" class="btn">Delete</button>
          <button onclick="downloadStudentAdmission('${s.id}')" class="btn">Admission PDF</button>
          <button onclick="generateMarksheet('${s.id}')" class="btn">Marksheet</button>
        </div>`;
      grid.appendChild(box);
    });
  }

  function editStudent(id){
    const s = getStudents().find(x=>x.id===id); if(!s) return;
    // fill short form
    const parts = (s.name||'').split(' ');
    document.getElementById('stuFirst').value = parts[0]||'';
    document.getElementById('stuMiddle').value = parts.slice(1,-1).join(' ')||'';
    document.getElementById('stuLast').value = parts.slice(-1).join(' ')||'';
    document.getElementById('stuAadhaarName').value = s.aadhaarName||'';
    document.getElementById('stuFather').value = s.father||'';
    document.getElementById('stuMother').value = s.mother||'';
    document.getElementById('stuResidence').value = s.residence||'';
    document.getElementById('stuTehsil').value = s.tehsil||'';
    document.getElementById('stuDistrict').value = s.district||'';
    document.getElementById('stuFatherPhone').value = s.fatherPhone||'';
    document.getElementById('stuMotherPhone').value = s.motherPhone||'';
    document.getElementById('stuAadhaar').value = s.aadhaar||'';
    document.getElementById('stuDob').value = s.dob||'';
    document.getElementById('stuDobWords').value = s.dobWords||'';
    document.getElementById('stuBankAcc').value = s.bankAcc||'';
    document.getElementById('stuBankName').value = s.bankName||'';
    document.getElementById('stuBranch').value = s.branch||'';
    document.getElementById('stuIFSC').value = s.ifsc||'';
    document.getElementById('stuCategory').value = s.category||'';
    document.getElementById('stuBlood').value = s.blood||'';
    document.getElementById('stuRation').value = s.ration||'';
    document.getElementById('stuClass').value = s.class||'';
    document.getElementById('stuRoll').value = s.roll||s.id;
    document.getElementById('stuPhoto').value = s.photo||'';
    document.getElementById('stuDeclaration').value = s.declaration||'';
  }

  function deleteStudent(id){
    if(!confirm('Delete student?')) return;
    const arr = getStudents().filter(x=>x.id!==id); setStudents(arr); renderStudents(); populateClassFilter();
  }

  function populateClassFilter(){
    const sel = document.getElementById('classFilter');
    const classes = Array.from(new Set(getStudents().map(s=>s.class).filter(Boolean))).sort();
    sel.innerHTML = '<option value="">All Classes</option>';
    classes.forEach(c=> sel.innerHTML += `<option value="${c}">${c}</option>`);
  }

  // Roll statement generator (download class roll)
  function downloadRollStatement(){
    const cls = document.getElementById('classFilter').value;
    if(!cls){ alert('Select class first'); return; }
    const students = getStudents().filter(s=>s.class===cls).sort((a,b)=> (a.roll||a.id).localeCompare(b.roll||b.id));
    if(students.length===0){ alert('No students for class '+cls); return; }
    let rows = '';
    students.forEach((s, i)=> rows += `<tr><td>${i+1}</td><td>${s.roll||s.id}</td><td style="text-align:left">${s.name}</td><td>${s.father||''}</td></tr>`);
    const html = `<div style="text-align:center"><h2>Roll Statement — Class ${cls}</h2><h3>GOVT PRIMARY SCHOOL PETHGAM WAGOORA</h3>
      <table style="width:100%;border-collapse:collapse;margin-top:12px">
        <thead><tr><th>Sr</th><th>Roll</th><th>Name</th><th>Father</th></tr></thead>
        <tbody>${rows}</tbody>
      </table></div>`;
    openPrintable(html, `RollStatement_Class_${cls}`);
  }

  // Download individual admission form (simple printable)
  function downloadStudentAdmission(id){
    const s = getStudents().find(x=>x.id===id); if(!s) return;
    const html = `<div style="font-family:Arial;padding:10px">
      <h2 style="text-align:center">ADMISSION FORM</h2>
      <h3>GOVT PRIMARY SCHOOL PETHGAM WAGOORA</h3>
      <table style="width:100%;border-collapse:collapse">
        <tr><td><strong>Student Name:</strong> ${s.name}</td><td><strong>Adm No:</strong> ${s.id}</td></tr>
        <tr><td><strong>Father:</strong> ${s.father}</td><td><strong>Mother:</strong> ${s.mother}</td></tr>
        <tr><td><strong>DOB:</strong> ${s.dob}</td><td><strong>Class:</strong> ${s.class}</td></tr>
        <tr><td colspan="2"><strong>Residence:</strong> ${s.residence}</td></tr>
      </table>
    </div>`;
    openPrintable(html, `Admission_${s.name}`);
  }

  // Simple marksheet generator (assumes results stored in gps_results)
  const RKEY='gps_results'; // results array: {studentId, subject, fa1..fa6, cca, sa, total, max}
  const SUBJECTS = ['English','Math','EVS','Urdu','Kashmiri'];
  function getResults(){ return JSON.parse(localStorage.getItem(RKEY)||'[]'); }

  function generateMarksheet(studentId){
    const students = getStudents();
    const results = getResults();
    const student = students.find(s=>s.id===studentId);
    const studentResults = results.filter(r=>r.studentId===studentId);

    // build marks table
    let rows = '';
    let grandTotal=0, totalMax=SUBJECTS.length*100;
    SUBJECTS.forEach(sub=>{
      const r = studentResults.find(x=>x.subject===sub) || {};
      const fa1= r.fa1||0,fa2=r.fa2||0,fa3=r.fa3||0,fa4=r.fa4||0,fa5=r.fa5||0,fa6=r.fa6||0,cca=r.cca||0,sa=r.sa||0;
      const total = r.total|| (fa1+fa2+fa3+fa4+fa5+fa6+cca+sa);
      grandTotal+=total;
      rows += `<tr><td style="text-align:left">${sub}</td><td>${fa1}</td><td>${fa2}</td><td>${fa3}</td><td>${fa4}</td><td>${fa5}</td><td>${fa6}</td><td>${fa1+fa2+fa3+fa4+fa5+fa6}</td><td>${cca}</td><td>${sa}</td><td>${total}</td></tr>`;
    });
    const percent = Math.round((grandTotal/totalMax)*100);
    const html = `<div style="font-family:Arial">
      <h2 style="text-align:center">GOVT PRIMARY SCHOOL PETHGAM WAGOORA</h2>
      <h3 style="text-align:center">Marksheet — ${student.name}</h3>
      <table style="width:100%;border-collapse:collapse">
        <thead><tr>
          <th>Subject</th><th>FA1</th><th>FA2</th><th>FA3</th><th>FA4</th><th>FA5</th><th>FA6</th><th>Total FA</th><th>CCA</th><th>SA</th><th>Total</th>
        </tr></thead>
        <tbody>${rows}
        <tr><td style="text-align:right;font-weight:bold">Grand Total</td><td colspan="9"></td><td>${grandTotal}</td></tr>
        </tbody>
      </table>
      <div style="margin-top:12px"><strong>Percentage:</strong> ${percent}%</div>
      <div style="margin-top:8px;display:flex;justify-content:space-between"><div>Sign. Form Teacher</div><div>Sign. Exam I/C</div><div>Parents Signature</div><div>Headmaster</div></div>
    </div>`;
    openPrintable(html, `Marksheet_${student.name}`);
  }

  function openPrintable(content, title='Doc'){
    const w = window.open('','_blank');
    w.document.write(`<html><head><title>${title}</title><style>body{font-family:Arial;padding:20px} table{width:100%;border-collapse:collapse} table,td,th{border:1px solid #444;padding:6px}</style></head><body>${content}<script>setTimeout(()=>window.print(),200)</script></body></html>`);
    w.document.close();
  }

  function downloadAllStudentCards(){
    const arr = getStudents();
    if(arr.length===0){ alert('No students'); return; }
    let html = '';
    arr.forEach(s => html += `<div style="page-break-after:always">${generateCardHtml(s)}</div>`);
    openPrintable(html,'AllStudentCards');
  }
  function generateCardHtml(s){
    return `<div style="font-family:Arial;text-align:center">
      <h2>GOVT PRIMARY SCHOOL PETHGAM WAGOORA</h2>
      <h3>Student Card</h3>
      <div style="margin-top:8px;font-weight:bold">${s.name}</div>
      <div>${s.class||''} • Roll: ${s.roll||s.id}</div>
    </div>`;
  }

  document.addEventListener('DOMContentLoaded', ()=>{ renderStudents(); populateClassFilter(); });
</script>
</body>
</html>
